<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>War Council Frontend Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-header {
            color: #1976d2;
            border-bottom: 2px solid #1976d2;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background-color: #1976d2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #1565c0;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #1976d2;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .data-display {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .permission-test {
            background-color: #fff3e0;
            border: 1px solid #ffcc02;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="test-header">üèõÔ∏è War Council Structure Frontend Test</h1>
        <p>This test page validates the War Council Structure frontend functionality and API integration.</p>
        
        <div class="test-section">
            <h3>üîß API Configuration Test</h3>
            <button onclick="testAPIConnection()">Test API Connection</button>
            <div id="api-connection-result"></div>
        </div>

        <div class="test-section">
            <h3>üìä War Council Structure Test</h3>
            <button onclick="testWarCouncilStructure()">Load War Council Structure</button>
            <div id="structure-result"></div>
            <div id="structure-data" class="data-display" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>üìà War Council Dashboard Test</h3>
            <button onclick="testWarCouncilDashboard()">Load War Council Dashboard</button>
            <div id="dashboard-result"></div>
            <div id="dashboard-data" class="data-display" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>üë• War Council Positions Test</h3>
            <button onclick="testWarCouncilPositions()">Load War Council Positions</button>
            <div id="positions-result"></div>
            <div id="positions-data" class="data-display" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>üîç Available Positions Test</h3>
            <button onclick="testAvailablePositions()">Load Available Positions</button>
            <div id="available-result"></div>
            <div id="available-data" class="data-display" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>‚úÖ Validation Test</h3>
            <button onclick="testAppointmentValidation()">Test Appointment Validation</button>
            <div id="validation-result"></div>
            <div id="validation-data" class="data-display" style="display: none;"></div>
        </div>

        <div class="test-section">
            <h3>üîê Permission System Test</h3>
            <div class="permission-test">
                <p><strong>Note:</strong> Permission tests simulate different user roles. In a real application, these would be based on actual user authentication.</p>
            </div>
            <button onclick="testPermissions()">Test Permission System</button>
            <div id="permission-result"></div>
        </div>

        <div class="test-section">
            <h3>üß™ Run All Tests</h3>
            <button onclick="runAllTests()" id="run-all-btn">Run All Tests</button>
            <div id="all-tests-result"></div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:5000/api';
        
        // Utility functions
        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="test-result ${type}">${message}</div>`;
        }

        function showLoading(elementId) {
            const element = document.getElementById(elementId);
            element.innerHTML = '<div class="loading"></div> Testing...';
        }

        function showData(elementId, data) {
            const element = document.getElementById(elementId);
            element.textContent = JSON.stringify(data, null, 2);
            element.style.display = 'block';
        }

        // Test functions
        async function testAPIConnection() {
            showLoading('api-connection-result');
            
            try {
                const response = await fetch(`${API_BASE_URL}/health`);
                if (response.ok) {
                    showResult('api-connection-result', '‚úÖ API connection successful', 'success');
                } else {
                    showResult('api-connection-result', `‚ùå API connection failed: ${response.status}`, 'error');
                }
            } catch (error) {
                showResult('api-connection-result', `‚ùå API connection failed: ${error.message}`, 'error');
            }
        }

        async function testWarCouncilStructure() {
            showLoading('structure-result');
            
            try {
                const response = await fetch(`${API_BASE_URL}/leadership/war-council/structure`);
                const data = await response.json();
                
                if (response.ok && data.success) {
                    const structure = data.data.structure;
                    const stats = data.data.statistics;
                    
                    showResult('structure-result', 
                        `‚úÖ War Council Structure loaded successfully<br>
                        üìä Total Positions: ${stats.total_positions}<br>
                        ‚úÖ Filled: ${stats.filled_positions}<br>
                        ‚ö†Ô∏è Vacant: ${stats.vacant_positions}<br>
                        üìà Fill Rate: ${stats.fill_rate_percentage}%`, 'success');
                    
                    showData('structure-data', data.data);
                } else {
                    showResult('structure-result', `‚ùå Failed to load structure: ${data.message || 'Unknown error'}`, 'error');
                }
            } catch (error) {
                showResult('structure-result', `‚ùå Error loading structure: ${error.message}`, 'error');
            }
        }

        async function testWarCouncilDashboard() {
            showLoading('dashboard-result');
            
            try {
                const response = await fetch(`${API_BASE_URL}/leadership/war-council/dashboard`);
                const data = await response.json();
                
                if (response.ok && data.success) {
                    const dashboard = data.data;
                    
                    showResult('dashboard-result', 
                        `‚úÖ War Council Dashboard loaded successfully<br>
                        üìä Recent Appointments: ${dashboard.recent_appointments.length}<br>
                        ‚ö†Ô∏è Vacant Positions: ${dashboard.vacant_positions.length}<br>
                        üìà Core Positions Filled: ${dashboard.statistics.core_positions_filled}/${dashboard.statistics.core_positions_total}<br>
                        üåç CCT Deployees Filled: ${dashboard.statistics.cct_deployees_filled}/${dashboard.statistics.cct_deployees_total}`, 'success');
                    
                    showData('dashboard-data', dashboard);
                } else {
                    showResult('dashboard-result', `‚ùå Failed to load dashboard: ${data.message || 'Unknown error'}`, 'error');
                }
            } catch (error) {
                showResult('dashboard-result', `‚ùå Error loading dashboard: ${error.message}`, 'error');
            }
        }

        async function testWarCouncilPositions() {
            showLoading('positions-result');
            
            try {
                const response = await fetch(`${API_BASE_URL}/leadership/war-council/positions`);
                const data = await response.json();
                
                if (response.ok && data.success) {
                    const positions = data.data.positions;
                    const corePositions = positions.filter(p => !p.province_specific);
                    const cctPositions = positions.filter(p => p.province_specific);
                    
                    showResult('positions-result', 
                        `‚úÖ War Council Positions loaded successfully<br>
                        üèõÔ∏è Core Positions: ${corePositions.length}<br>
                        üåç CCT Deployees: ${cctPositions.length}<br>
                        üìä Total Positions: ${positions.length}`, 'success');
                    
                    showData('positions-data', positions);
                } else {
                    showResult('positions-result', `‚ùå Failed to load positions: ${data.message || 'Unknown error'}`, 'error');
                }
            } catch (error) {
                showResult('positions-result', `‚ùå Error loading positions: ${error.message}`, 'error');
            }
        }

        async function testAvailablePositions() {
            showLoading('available-result');
            
            try {
                const response = await fetch(`${API_BASE_URL}/leadership/war-council/positions/available`);
                const data = await response.json();
                
                if (response.ok && data.success) {
                    const positions = data.data.positions;
                    
                    showResult('available-result', 
                        `‚úÖ Available positions loaded successfully<br>
                        üìä Available Positions: ${positions.length}`, 'success');
                    
                    showData('available-data', positions);
                } else {
                    showResult('available-result', `‚ùå Failed to load available positions: ${data.message || 'Unknown error'}`, 'error');
                }
            } catch (error) {
                showResult('available-result', `‚ùå Error loading available positions: ${error.message}`, 'error');
            }
        }

        async function testAppointmentValidation() {
            showLoading('validation-result');
            
            try {
                // First get a position to test with
                const positionsResponse = await fetch(`${API_BASE_URL}/leadership/war-council/positions`);
                const positionsData = await positionsResponse.json();
                
                if (!positionsResponse.ok || !positionsData.success) {
                    throw new Error('Could not load positions for validation test');
                }
                
                const testPosition = positionsData.data.positions.find(p => p.position_code === 'PRES');
                if (!testPosition) {
                    throw new Error('Could not find President position for testing');
                }
                
                // Test validation
                const validationResponse = await fetch(`${API_BASE_URL}/leadership/war-council/appointments/validate`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        position_id: testPosition.id,
                        member_id: 1 // Test member ID
                    })
                });
                
                const validationData = await validationResponse.json();
                
                if (validationResponse.ok && validationData.success) {
                    const validation = validationData.data;
                    
                    showResult('validation-result', 
                        `‚úÖ Validation test completed<br>
                        üìä Position: ${testPosition.position_name}<br>
                        ‚úÖ Valid: ${validation.isValid ? 'Yes' : 'No'}<br>
                        ${validation.errors ? `‚ùå Errors: ${validation.errors.length}` : ''}`, 
                        validation.isValid ? 'success' : 'warning');
                    
                    showData('validation-data', validation);
                } else {
                    showResult('validation-result', `‚ùå Validation test failed: ${validationData.message || 'Unknown error'}`, 'error');
                }
            } catch (error) {
                showResult('validation-result', `‚ùå Error in validation test: ${error.message}`, 'error');
            }
        }

        function testPermissions() {
            showLoading('permission-result');
            
            // Simulate different user types
            const testUsers = [
                { admin_level: 'national', role_name: 'admin', is_active: true },
                { admin_level: 'province', role_name: 'admin', is_active: true },
                { admin_level: 'municipality', role_name: 'admin', is_active: true },
                { role_name: 'super_admin', is_active: true },
                { admin_level: 'ward', role_name: 'user', is_active: true }
            ];
            
            let results = [];
            
            testUsers.forEach((user, index) => {
                // Simulate permission checks (this would normally use the actual permission utility)
                const canView = ['national', 'province'].includes(user.admin_level) || user.role_name === 'super_admin';
                const canManage = user.admin_level === 'national' || user.role_name === 'super_admin';
                
                results.push(`
                    <strong>User ${index + 1}:</strong> ${user.admin_level || 'no level'} ${user.role_name}<br>
                    üëÅÔ∏è Can View: ${canView ? '‚úÖ' : '‚ùå'}<br>
                    ‚öôÔ∏è Can Manage: ${canManage ? '‚úÖ' : '‚ùå'}<br>
                `);
            });
            
            showResult('permission-result', 
                `‚úÖ Permission system test completed<br><br>${results.join('<br>')}`, 'success');
        }

        async function runAllTests() {
            const button = document.getElementById('run-all-btn');
            button.disabled = true;
            button.textContent = 'Running Tests...';
            
            showResult('all-tests-result', 'üöÄ Running all tests...', 'info');
            
            try {
                await testAPIConnection();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                await testWarCouncilStructure();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                await testWarCouncilDashboard();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                await testWarCouncilPositions();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                await testAvailablePositions();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                await testAppointmentValidation();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                testPermissions();
                
                showResult('all-tests-result', 'üéâ All tests completed! Check individual test results above.', 'success');
            } catch (error) {
                showResult('all-tests-result', `‚ùå Test suite failed: ${error.message}`, 'error');
            } finally {
                button.disabled = false;
                button.textContent = 'Run All Tests';
            }
        }

        // Auto-run API connection test on page load
        window.addEventListener('load', () => {
            testAPIConnection();
        });
    </script>
</body>
</html>
